---
# we need to remove the fstab generated by setup-fstab-for-overlayfs for live image
- name: remove generated overlayfs fstab
  file:
    path: /etc/fstab
    state: absent

- name: set 'install_weak_deps=False' dnf option
  ini_file:
    path: /etc/dnf/dnf.conf
    no_extra_spaces: yes
    create: no
    section: main
    option: install_weak_deps
    value: 'False'

- name: disable timeline snapshots
  lineinfile:
    path: /etc/snapper/configs/root
    regexp: '^TIMELINE_CREATE='
    line: 'TIMELINE_CREATE="no"'

- name: reduce number of snapshots
  lineinfile:
    path: /etc/snapper/configs/root
    regexp: '^NUMBER_LIMIT='
    line: 'NUMBER_LIMIT="2-10"'

- name: reduce number of important snapshots
  lineinfile:
    path: /etc/snapper/configs/root
    regexp: '^NUMBER_LIMIT_IMPORTANT='
    line: 'NUMBER_LIMIT_IMPORTANT="4-10"'
